<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Cálculo do FPM</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet" />
    <style>
        /* INÍCIO DO ESTILO */
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 10px;
            background: #8C2D2D;
            color: #000000;
            font-size: 14px;
            font-weight: 700;
        }
        .topbar {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            color: #FFFFFF;
        }
        .download-btn {
            padding: 10px 15px;
            font-size: 14px;
            border-radius: 0;
            background: #D9C6A5;
            color: #000000;
            border: 2px solid #000000;
            cursor: pointer;
            font-weight: 700;
            box-shadow: 4px 4px 0px #000000;
            transition: all 0.15s ease-out;
        }
        .download-btn:hover {
            background: #4A2A20;
            color: #D9C6A5;
            box-shadow: 2px 2px 0px #000000;
            transform: translate(2px, 2px);
        }
        .date-time {
            flex-grow: 1;
            font-style: normal;
            color: #FFFFFF;
            font-size: 14px;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: #D9C6A5;
            padding: 15px;
            border-radius: 0;
            border: 3px solid #000000;
            box-shadow: 10px 10px 0px #000000;
        }
        .date-time-pdf {
            font-size: 12px;
            color: #000000;
            margin-bottom: 8px;
        }
        .logo {
            text-align: center;
        }
        .logo img {
            width: 120px;
            height: auto;
            margin-bottom: 10px;
        }
        .logos-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0 20px;
            margin-bottom: 15px;
            min-height: 120px; /* Altura mínima para posicionamento vertical */
        }
        .logos-container .logo:last-child {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }
        .highlight {
            text-align: center;
            background: #4A2A20;
            color: #D9C6A5;
            border-radius: 0;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #000;
        }
        .highlight .title-wide {
            font-size: 24px;
            font-weight: 900;
            text-transform: uppercase;
        }
        .highlight .subtitle {
            font-size: 18px;
            font-weight: 700;
            opacity: 1;
        }
        .multiplier {
            margin-top: 12px;
            border-left: none;
            border: 2px solid #000;
            background: #FFFFFF;
            padding: 10px 15px;
            border-radius: 0;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .multiplier input {
            font-size: 15px;
            border: none;
            text-align: right;
            background: transparent;
            width: 100px;
            font-weight: 700;
        }
        .data-box,
        .deductions {
            margin-top: 12px;
            background: #FFFFFF;
            padding: 10px 15px;
            border-radius: 0;
            box-shadow: none;
            border: 2px solid #000;
        }
        .data-box.yellow {
            background: #EFE1C5;
        }
        .data-box.green {
            background: #A88F71;
            color: #fff;
        }
        .data-row {
            display: grid;
            grid-template-columns: 1fr auto;
            padding: 6px 0;
            font-size: 15px;
        }
        input.edit {
            border: none;
            background: transparent;
            font-size: 15px;
            text-align: right;
            width: 100%;
            font-weight: 700;
        }
        input.edit:focus {
            outline: 2px solid #000;
            background: #f0f0f0;
        }
        .blue-section {
            background: #8C2D2D;
            color: #D9C6A5;
            padding: 20px;
            margin-top: 20px;
            border-radius: 0;
            text-align: center;
            border: 2px solid #000;
        }
        .blue-section input {
            background: transparent;
            border: none;
            border-bottom: 2px solid #D9C6A5;
            width: 40px;
            font-size: 18px;
            font-weight: 900;
            color: #D9C6A5;
            text-align: center;
        }
        .blue-section .label {
            margin: 0 5px 0 15px;
        }
        .blue-section #resultadoMultiplicacao {
            font-size: 2.5em;
            font-weight: 900;
            color: #000000;
            background: none;
            padding: 10px 20px;
            border-radius: 0;
            box-shadow: none;
            letter-spacing: 1px;
            display: block;
            margin-top: 10px;
            border: 2px solid #000;
            background-color: #D9C6A5;
        }
        .blue-section #resultadoMultiplicacao:hover {
            transform: none;
        }
        .liquid {
            margin-top: 12px;
            padding: 15px;
            background: #000000;
            color: #D9C6A5;
            font-weight: 700;
            text-align: center;
            font-size: 18px;
            border: 2px solid #000;
        }
        .chart-container {
            margin-top: 30px;
            padding: 10px;
            border: 2px solid #000;
            background-color: #fff;
        }
        canvas#grafico {
            max-width: 100%;
            height: 350px !important;
        }
        .logo-footer {
            text-align: center;
            background-color: #4A2A20;
            color: #D9C6A5;
            padding: 20px;
            border-radius: 0;
            font-size: 17px;
            margin-top: 20px;
            border: 3px solid #000;
            box-shadow: 8px 8px 0 #8C2D2D;
        }
        .logo-footer img {
            width: 100px;
            margin-bottom: 4px;
        }
        .logo-footer .footer-text {
            font-weight: 500;
        }
        .logo-footer .footer-text strong {
            color: #FFFFFF;
        }
        #tela-senha {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .caixa-senha {
            background: #D9C6A5;
            padding: 30px;
            border: 3px solid #000;
            box-shadow: 10px 10px 0px #000000;
            text-align: center;
        }
        .caixa-senha h2 {
            margin: 0 0 15px 0;
            font-size: 20px;
            color: #4A2A20;
        }
        .caixa-senha input {
            padding: 10px;
            font-size: 16px;
            border: 2px solid #000;
            margin-bottom: 15px;
            width: 200px;
            text-align: center;
        }
        .caixa-senha button {
            width: 100%;
        }
        #mensagem-erro {
            color: #8C2D2D;
            font-weight: bold;
            margin-top: 10px;
            min-height: 20px;
        }
        .abas-container {
            display: flex;
            margin-bottom: 15px;
        }
        .aba {
            padding: 10px 20px;
            cursor: pointer;
            border: 2px solid #000;
            background-color: #EFE1C5;
            color: #000;
            font-weight: 700;
            font-size: 16px;
            border-bottom: none;
        }
        .aba.active {
            background-color: #00A8A8;
            color: #000;
        }
        .conteudo-aba {
            display: none;
            padding-top: 10px;
        }
        .conteudo-aba.active {
            display: block;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #4A2A20;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #graficos-historico-container canvas {
            max-width: 100%;
            height: 250px !important;
        }
         @media (min-width: 768px) {
            #graficos-historico-container {
                /* For more than one chart, use grid */
                /* grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); */
            }
        }
    </style>
</head>
<body>

    <div id="tela-senha">
        <div class="caixa-senha">
            <h2>Acesso Restrito</h2>
            <input type="password" id="campo-senha" placeholder="Digite a senha">
            <button onclick="verificarSenha()" class="download-btn">ENTRAR</button>
            <div id="mensagem-erro"></div>
        </div>
    </div>

    <div id="conteudo-protegido" style="display: none;">

        <div class="topbar">
            <div class="date-time" id="dataHoraTela"></div>
            <button onclick="baixarPNG()" class="download-btn">📥 BAIXAR PNG</button>
        </div>

       <div class="container">
            <div class="abas-container">
                <button class="aba active" onclick="mostrarAba('calculadora', this)">Calculadora FPM</button>
                <button class="aba" onclick="mostrarAba('historico', this)">Histórico</button>
            </div>
			
            <div id="calculadora" class="conteudo-aba active">
                <!-- Conteúdo da Calculadora -->
                <div class="date-time-pdf">📅 Emitido em: <span id="dataHoraPdf"></span></div>

                <div class="logos-container">
                    <div class="logo"><img src="data:image/png;base64,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" alt="Brasão Principal" style="width: 250px;"></div>
                    <div class="logo">
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG8AAAB9CAMAAACbBc3CAAABAlBMVEX///9fGg3z1s7xy8LvxbuSZFtgGwz56ORyNSn56+f12tP89fNtLiJiHg7++vny0MepgnzezcujeXLqtqlMCQFCAgHz1M3SvblJBgGNW1HFqqTo3du0kItZFAdGAwH/5NuVamn/3NKETkVRDQJ7QTftwLVbHhpqKR3qs6WqiIRwLB69n5rGraiZaWL/69+SUEDj19Xx7Ov+1suiZ1uqcWJuNjRcJiKlfHSEQzWjgH7Vw8L/4NWARz1wOzfbr6OFVVGqdmy8iHzBmJDRn5NMIyLauLH3xbe9h3h+Oy3Mo5t6UVBSGhiPY2BcHhPjycN8SUTMkH81AQBeNza4emuRTz+iYVPSjZq5AAAM4klEQVRoge1bC3eiSBamBEFBQQXFFxJFmthqWkh3m6jJJOkxnczm0bPT/f//ytYbBE1MNtlzdnfuyQmVWwVfPe4bIgh/0/8IjQuy3KzLMoAkg7pVZq0m4ZWdulcGmCf3KA+2erQXsN54XNmrO+VgHm5Dm5VAkD84Pj6ozWvwB7dqm63a5+nBfINX2+jN014+7mD6uZYfAjDJwnUAsOHFdRnDLfIW5x1pWV6it5gZpx2hlQy3ABYAXrVqMIbIn2OorOUXs7xGjrUkJTOu6OPLEKS31AZtcrfI7+ZPFBucV8zyDD7DGE9K4YVgmsLLA3LNcTwxxotXUMzynsaTyHUFUniF4F3xKnIKr/SBXBPnx++Oz0rUsrwcRxaLmXEaxRul8c4KqtvI5XK+mWtgyplSjpLp85aY5fnbellLNOGvhupeNNN4N/1IhGSafUqmj35HUQR5IiVT4i1zS8vPjJNIp3vR27WffJ/cLbIv7bmfUmY/M/JSoiiXp6cHBwe109HllV0Ndczjmvh28sLwiid1bjXhpbSajhbnauY5L8bbtb7ipx7YpLLnFO7Gs/8YHpAdBy55OLc1weXn9454HDeYfuNm8M3wfvaSq9rcWcf6Upm9EV7A1vf7F0RfP0Bf2WtanuMkVoh+8nYKL7bmu/FOy2m8Dzomda3hqxb66+rkat4KnCaU1I2lDiZoVTqluCUprOWzluKTa8VJ4Z2duKIEybxm9uU66qtqQ/S/fT8+CTa31ht+M6HhkTCZpkTp0M+0/EN8Ofpez+xnqGuQDEmjJKn4AjV+qWqT+XBDReo3a10g40SR3eGrvKXQhuKT69xL492Ta8If8dMgnr5aGXo9urGybNXvqKw2Xnd+pQxe1v8tPnux0MrOCDP/PX142t+61VEhsa+r6jvjQT+qj5OIXXi674hHnpNAlB91t/82eNLu+EUfOU16kPLXy9jrvQKvwWcbca+3JV7qTB1Ppmbvag+8+a54yRUFnWhdf0u8FPt35faujpVDdnp/sHm9wL+f3Sxx/CKdfC0FQVAqnJ20uuu1CGMd99qPjM24xIiuI+mnx8zNynCNJ+OXo+/p+OWspCqqqrpG2aMa3fS8ugU+nhzfmoaiuJBU1TRUSr6kaLZFhcYDazhCNUXWy8cZJvrtuhdWCq9A97P40QMJcqxm7x+FeTWzn3iPOwNm375oz+znrvhF2cQjT7Oc+zvshTLxxJyuUPaqr4uXtuBRGnZDYZmJX8ZMEcFMiF6hDwo9v23+/X7k62k8YWI5OJeVm6H7GrzClxakwaoUZADLXrnLAphYJx/KRBPB13N+uvvjqdy+GOvFuNIKkNAw9y57XjBO4xVvvxDNtz6+Ai+2L318j7boPt57yXhiUN3EM1zdIgUD7/EFeJn8T+L27OHyj56XCJuQ3zNivKXQYQFObRfePO1veb6yxT9AOQi7JVbjQKI6E/ocD/n38J50Ou1d68vGS0sxFf3Qlghb/b5xflyOl+hdRddsHLwj6l+SsNHx1u6+8ZJSVCCJvkLJN3hLVJSipocji8UvTv2TWiziGxRJQr2TJhEoZ4bYvkpvVfHjikotEy/tk0+HF1w5LV5woPHSnKrMKd7PtD17XbwkuJMz6maBc0ZVkcUvA2rZkOF7q3gi0qHnZBasEG7gaQHhB/rbxhN2wKSGAPL4bGGRwt004Sme1/foqfXheYeDDcA4HpxTf1gVov3Xt2QcN+ML+D7l2Z4ON/AaxNbLX6lt2gfPPb6D5jpfq4y/PezEEw6YKW9Bu8fx3Ns/Mbtpq3vXlzRAjaFjWYXpuIN4W+pLbWbBDgSXz6YPjxCZGSc4Z6zd9aWbfl80DENi/hbnlgA8jlUl8hsGIVPCl77b+NQkePX10jRYb/QQoLvl+q8jypJI55b6UgHarEajIaX8OzySnz8MdbmEkI2GKeJal2Eslz9J3cTxfkQNSqZ/dFvH5g6aNfy0hmSi4bksXml7vAT116mDUWY/BVcdkfnUg1iuiqhsiyfJ6rmviZdkx/MoYiJeUgTqZr0u46F4aUEPgwYez8dLoP4xCJI1dvIAnHol8VwhJHGLbPFoEVncFRk/TuHtjCfOO6GmhZ3q5GJ1X04uc7yJp6IadKyFHG9BTcGeeI242q7qdi1IAOaF2G4QnZwnpsLwBJro23vixfYTlfLDcVwnkM+EOOIj9fICUYqynsCbEF5rP7ysvR5/aJIIEzjDdPxZpT2VBJ4QkHMNN/BeUr/uek3yCCvgeNTmjIhQeZhPvcKExKNYbJ/Ix/qRtK06HPX70Y/Ao8o2zC3jKrIULc+Jia5fHtE7JHF5DlAsY52gB/qHO+rJMB9zUeok+Tynknju5SoDEivJ3kfVdUk+hruOuri854C1y/Ix1x2gOTjOLWQ9m49tjV+gzE6ptWnaG/spCGThnh3vJ8lhZGci7GFfcnF1Y9PfsszLmcU8RF3CRvrG8rGQsAbCHvbF5f42HU/UQFKTOV5IHdMikf+1AJPQZ/Xh4bg2GtvI7fXT8QQLI7obeHAeMrUG/ARoUjjZA88mjnRVm4npeEJnxibcwHugBl6P880OmUJtHzz6zHLzZp3CE6o0iKht4CkfLWrA4vx2KFO7+jweC4XKVn212MQT7uhZhcn8SPmFfSw4SOBd9OgB7pYXqg9VkCRip+L4pUDipANoZzmvePUV130+xFGZQNy8vHgifiH6rlz9uVGrflSKXLdVVyHzBpZ6FFsD0R/iE2w+RKz+4n7D6VLv0t2p78SeSZE5/G2QKB17H8/7EbdxkUnMl/Wd8HAVyYwu8Syal9cwCyMDD/G43q++dIiHHf216/0Yri522nl+io9JzVAvUNolg7skT9HwJLwxjzoFA0cl8qOgUXez8/1Yjsbzs9/q2NfI4J/Ckleo+w8kzasLapzfqgIWUKcVe//GTwvbIqFI8Xbal9j/rQHxK84kx9cSaQdkmzvxe0IoTV/wuNI5xyP7ADyNrW8Pf3u0/oNITu/yiOPpNsmbx7F8Gn2oJ/hUf/BosX9F3MbsBXjQvpSwoDdvEu+BdeKYpuv4a4ClcIp5zb9ivDXBs7VobzxofWnE59mJOZDa9dltEq9N9uE4xiOlSmei74+H3nJgayODMz6HInWE999j77ikMWD9V4xX/YBZ45fgoRMakBXOYrwRllrrcyz7S2FG1vczxpthEQIjvp97xks6jofkU8bThAU2aYm1IOnFCtg74U/rh1jW5JFAy2Pb8rElypz8OLvyYV7TKKGD8IZqn/BE99Yiexexcb65FHGE1LwxWN52La3QFKxjAz9uS36E8r8MnmEcXSHL6wDfpfmfe74FzwhwRJbAEzFes0XwGrvzsXS81HGwhIZ8P0OsEL1PG/uJPbF1E++nfkcdya793FV/0bDAlGk+B+WlWiZ4SfnUCwSPzyEq/obl5S7cJS876z3EWbCMpEgdZP1XLJ99Gmk8ibd3fWmIM/kux2sTg/0rqQ8kAGzGeH3lEbMOXo5XKHuW5cR41Qqi08vkfnbQYZX/TOB1iL4fvMCeUbxZtXp+Xg05Hnti/P0S3M8OJp/PIeosbESd4ovxBEHYUudPvHWP60v9l7wP2Ot7om3fvzS2fL21R/2T1nclk1V1TVEhtVnF9EmfohzmeK/Eq78+HgR/DnlF+LChFBEpjUNa383ES7R+/T6UrV8z+/JOlKnPs/cP70SZ9w9MPt+JdurD/wPerN1mJbGwSqhD/tQX7Qnr6iD+jH9gpFdZB74JXeGFdT+BF+JseNCh4wiRJHqB/U6LKDNJmmkKhdNtFsahHLKKv2BlfuUJPK0EShUIE+CpdUEwRYTtNXQDg+6claryYDiNv5XVAeMTvC7JqtvP4lXAUMdzmxC8xIeiNkBKMymTKlMeT35KUdqgVGYfscJxYIU2INgDr0DGzDoawWvFY+Ak0EdogibEeF0wwH8NwaLC9tYGrSFM50Eh/zxeiLeeU5een03vgvs8pVl2HkwXdrdMyhUwAoWeP2B4tRHoaGBeeR6vk8YrB4ioKNg4L6xRPEwDvNoaWluBTgviVUHbBnb3eTwNV24gbkjxWpvjQrtGZ5QHq1qtQqUlAINprUD31gZTHawGQNtjfcKKTL+0RV66JfxHgUh5ngs7lCG67aBD8FoozCrBVT+PB4V5HIZwETOCNyCxAvoDhkrtMBzTrjzghXlhAKZI+wtEYmy4zgra9j3khas4Gckq1GQ4PbIaxWBvo1F+hLd/TK4TaB7QtOGQ5/UdTq8VlPJUQCat1gAR3dXxIAgG9BndFpu80G4R6LCFX85XWxXYbHXgEGZydr5/fyfK4OXTjLelYfrxi4S0vT114rOOZ9B5P7xC5v8DkCHb8l8Rb0JQT7b9wwV0boP82xP6pMXOwkFqr8B7UKGrbYX7m/4b6V+M8GIj9vGepQAAAABJRU5ErkJggg==" alt="Logo Cespam">
                        <div class="Logo-text"><strong>Competência em Gestão Municipal</strong></div>
                    </div>
                </div>

                <div class="highlight">
                    <div class="title-wide">PREFEITURA MUNICIPAL</div>
                    <div class="subtitle" id="subtitle">Camocim de São Félix</div>
                </div>
            
                <div class="multiplier">
                    FATOR DE MULTIPLICAÇÃO:
                    <input type="text" id="multiplicador" class="edit" value="0.0000">
                </div>
            
                <div class="data-box yellow">
                    <div class="data-row">
                        <span>3ª Cota – Valor Bruto</span>
                        <input id="valorBrutoAnterior" class="edit" value="0,00">
                    </div>
                </div>
            
                <div class="data-box green">
                    <div class="data-row">
                        <span>Cota equivalente – Valor Líquido</span>
                        <input id="valorLiquidoAnterior" class="edit" value="0,00">
                    </div>
                    <div class="data-row">
                        <span>Cota equivalente – Valor Bruto</span>
                        <input id="valorBrutoEquivalente" class="edit" value="0,00">
                    </div>
                    <div class="data-row">
                        <span>Índice de Repasse</span>
                        <span id="pesoPercentualFormatted">0,00%</span>
                    </div>
                </div>
            
                <div class="blue-section">
                    <strong>COTA Nº</strong>
                    <input id="cotaNumero" class="edit" value="00">
                    <span class="label">MÊS</span>
                    <input id="cotaMes" class="edit" value="00">
                    <span class="label">ANO</span>
                    <input id="cotaAno" class="edit" value="00">
                    <br><br>
                    <span style="font-size:1.5em;font-weight:bold;font-family:'Roboto',sans-serif;">
                        💰 VALOR BRUTO:
                    </span>
                    <span id="resultadoMultiplicacao">-</span>
                </div>
            
                <div class="deductions">
                    <div class="data-row"><span>PASEP 1%</span><span id="deducaoPasep">0,00</span></div>
                    <div class="data-row"><span>SAÚDE 15%</span><span id="deducaoSaude">0,00</span></div>
                    <div class="data-row"><span>FUNDEB 20%</span><span id="deducaoFundeb">0,00</span></div>
                    <div class="data-row">
                        <span>Parcelamento RFB</span>
                        <input id="parcelamentoRfb" class="edit" value="0,00" style="width:80px">
                    </div>
                    <div class="data-row">
                        <strong>TOTAL DEDUÇÕES</strong>
                        <strong id="totalDeducoes">0,00</strong>
                    </div>
                </div>
            
                <div class="liquid" style="margin-bottom: 20px;">
                    PREVISÃO LÍQUIDA - FPM: <span id="previsaoLiquida">0,00</span>
                </div>

                <div id="gemini-analysis-container" style="margin-bottom: 20px;">
                    <button onclick="gerarAnaliseGemini()" class="download-btn" style="width: 100%;">
                        ✨ OBTER ANÁLISE COM IA
                    </button>
                    <div id="gemini-loading" style="display: none; text-align: center; margin-top: 15px;">
                        <div class="spinner" style="margin: 0 auto 10px;"></div>
                        <p style="font-weight: bold; color: #4A2A20;">Analisando dados...</p>
                    </div>
                    <div id="gemini-result-box" style="display: none; margin-top: 15px; padding: 15px; background: #EFE1C5; border: 2px solid #000;">
                        <h3 style="margin: 0 0 10px 0; color: #4A2A20; font-size: 16px;">Análise Financeira ✨</h3>
                        <p id="gemini-result-text" style="font-size: 15px; line-height: 1.6;"></p>
                    </div>
                </div>

                <button onclick="salvarNoHistorico()" class="download-btn" style="width: 100%; margin-bottom: 20px;">
                    SALVAR CÁLCULO NO HISTÓRICO
                </button>

                <div class="grafico-legenda" style="text-align:center; font-size:16px; font-weight:bold; color:#000; margin:10px 0 10px;">
                    Comparativo entre o valor bruto do mês anterior e do mês atual
                </div>
                <div class="chart-container">
                    <canvas id="grafico"></canvas>
                </div>
            </div>
            <div id="historico" class="conteudo-aba">
                <h2 style="color: #4A2A20;">Histórico de Cálculos</h2>
                <div id="analise-historico-container" style="margin-bottom: 15px;"></div>
                
                <!-- Container dos Gráficos de Histórico -->
                <div id="graficos-historico-container" style="display: none; display: grid; grid-template-columns: 1fr; gap: 20px; margin-bottom: 25px;">
                    <div class="chart-container" style="margin-top:0; padding: 15px;">
                        <canvas id="grafico-bruto-historico"></canvas>
                    </div>
                    <div class="chart-container" style="margin-top:0; padding: 15px;">
                        <canvas id="grafico-deducoes-historico"></canvas>
                    </div>
                    <div class="chart-container" style="margin-top:0; padding: 15px;">
                        <canvas id="grafico-liquido-historico"></canvas>
                    </div>
                </div>

                <div id="historico-conteudo">
                    <p>Nenhum cálculo salvo ainda.</p>
                </div>
                 <button onclick="limparHistorico()" class="download-btn" style="background-color: #8C2D2D; color: #D9C6A5; margin-top: 15px;">Limpar Histórico</button>
            </div>
        </div>

        <div class="logo-footer">
            <img src="data:image/png;base64,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" alt="Logo Cespam">
                        <div class="footer-text"><strong>Sistema desenvolvido pelo CESPAM</strong> - Reprodução por Terceiros Proibida®</div>
        </div>
    </div>

    <div id="modal-fundo" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); z-index: 10000; align-items: center; justify-content: center;">
        <div id="modal-caixa" style="background: #fff; border: 3px solid #000; padding: 25px; text-align: center; box-shadow: 8px 8px 0 #000;">
            <p id="modal-mensagem" style="font-size: 16px; margin-bottom: 20px; line-height: 1.6;"></p>
            <div id="modal-botoes"></div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        const el = id => document.getElementById(id);
        const val = id => el(id).value;

        // ===================================================================================
        // IMPORTANTE: Para a análise com IA funcionar, você precisa de uma chave da API
        // do Google Gemini. Obtenha uma gratuitamente no Google AI Studio e cole aqui.
        // ===================================================================================
        const GEMINI_API_KEY = "AIzaSyCywncl_7WRMhHXWLkMjChhYDUMKN7YnO4"; 
        // ===================================================================================
        
        let graficoBrutoHistorico, graficoDeducoesHistorico, graficoLiquidoHistorico;

        // --- FUNÇÃO DE VERIFICAÇÃO DE SENHA ---
        function verificarSenha() {
            const SENHA_CORRETA = 'Cespam10';
            const senhaDigitada = val('campo-senha');
            const mensagemErro = el('mensagem-erro');
            if (senhaDigitada === SENHA_CORRETA) {
                el('tela-senha').style.display = 'none';
                el('conteudo-protegido').style.display = 'block';
            } else {
                mensagemErro.textContent = 'Senha incorreta. Tente novamente.';
                el('campo-senha').value = '';
            }
        }
        el('campo-senha').addEventListener('keyup', e => e.key === 'Enter' && verificarSenha());

        // --- CÓDIGO DAS ABAS ---
        function mostrarAba(idAba, elementoAba) {
            document.querySelectorAll('.conteudo-aba').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.aba').forEach(a => a.classList.remove('active'));
            el(idAba).classList.add('active');
            elementoAba.classList.add('active');
        }
        
        // --- MODAL PERSONALIZADO ---
        function mostrarModal(mensagem, tipo = 'alert', callbackConfirm = null) {
            el('modal-mensagem').innerHTML = mensagem;
            const botoesContainer = el('modal-botoes');
            botoesContainer.style.display = 'block';
            if (tipo === 'confirm') {
                botoesContainer.innerHTML = `
                    <button id="modal-btn-confirma" class="download-btn">Sim</button>
                    <button id="modal-btn-cancela" class="download-btn" style="background-color: #8C2D2D; color: #D9C6A5; margin-left: 10px;">Não</button>
                `;
                el('modal-btn-confirma').onclick = () => {
                    if (callbackConfirm) callbackConfirm();
                    fecharModal();
                };
                el('modal-btn-cancela').onclick = fecharModal;
            } else {
                botoesContainer.innerHTML = '<button id="modal-btn-ok" class="download-btn">OK</button>';
                el('modal-btn-ok').onclick = fecharModal;
            }
            el('modal-fundo').style.display = 'flex';
        }

        function fecharModal() {
            el('modal-fundo').style.display = 'none';
        }

        // --- GEMINI API FEATURES ---
        async function callGeminiApi(prompt, useSearch = false) {
            const loadingIndicator = el('gemini-loading');
            const resultBox = el('gemini-result-box');
            const resultText = el('gemini-result-text');
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${GEMINI_API_KEY}`;
            
            loadingIndicator.style.display = 'block';
            resultBox.style.display = 'none';
            resultText.innerHTML = '';

            const payload = { contents: [{ parts: [{ text: prompt }] }] };
            if (useSearch) {
                payload.tools = [{ "google_search": {} }];
            }
            
            let response;
            let retries = 3;
            let delay = 1000;

            while (retries > 0) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        const candidate = result.candidates?.[0];
                        if (candidate && candidate.content?.parts?.[0]?.text) {
                            loadingIndicator.style.display = 'none';
                            resultText.innerHTML = candidate.content.parts[0].text.replace(/\n/g, '<br>');
                            resultBox.style.display = 'block';
                            return; 
                        }
                    }
                } catch (error) {
                    console.error("Fetch error:", error);
                }
                retries--;
                if (retries > 0) await new Promise(resolve => setTimeout(resolve, delay));
                delay *= 2;
            }
            loadingIndicator.style.display = 'none';
            resultText.innerHTML = 'Não foi possível gerar a análise. Verifique sua chave da API e tente novamente.';
            resultBox.style.display = 'block';
        }

        function gerarAnaliseGemini() {
            const cotaNum = val('cotaNumero');
            const cotaMes = val('cotaMes');
            const cotaAno = val('cotaAno');
            const valorBrutoAnterior = val('valorBrutoAnterior');
            const valorBrutoEquivalente = val('valorBrutoEquivalente');
            const valorBrutoResultado = el('resultadoMultiplicacao').textContent;
            const totalDeducoes = el('totalDeducoes').textContent;
            const previsaoLiquida = el('previsaoLiquida').textContent;
            const municipio = el('subtitle').textContent || 'Camocim de São Félix';

            if (previsaoLiquida === '0,00' || previsaoLiquida === '-') {
                mostrarModal('Calcule um valor antes de solicitar a análise.');
                return;
            }
            if (GEMINI_API_KEY === "COLE_SUA_CHAVE_API_AQUI") {
                 mostrarModal('Por favor, adicione sua chave da API do Google Gemini no código para usar esta funcionalidade.');
                 return;
            }
            const prompt = `Aja como um analista financeiro especialista em contas públicas municipais no Brasil. Para o município de ${municipio}, o cálculo da ${cotaNum}ª cota do FPM do mês ${cotaMes}/${cotaAno} apresentou os seguintes dados:\n- Valor Bruto da Cota Anterior (base para o fator): R$ ${valorBrutoAnterior}\n- Valor Bruto da Cota Equivalente (mês anterior): R$ ${valorBrutoEquivalente}\n- Valor Bruto Calculado para a Cota Atual: R$ ${valorBrutoResultado}\n- Previsão Líquida para o município: R$ ${previsaoLiquida}\n\nCom base nesses dados, forneça uma análise concisa em um único parágrafo (máximo de 3-4 frases). A análise deve ser profissional, objetiva e útil para um gestor municipal. Compare brevemente o valor bruto atual com o do mês anterior, não comente sobre o impacto das deduções no valor líquido final. Finalize com uma recomendação prática ou ponto de atenção para a gestão financeira.`;
            callGeminiApi(prompt, true);
        }

        function analisarHistoricoComIA() {
            const historico = JSON.parse(localStorage.getItem('fpmHistorico')) || [];
            if (historico.length < 2) {
                mostrarModal('É necessário ter pelo menos dois registros no histórico para gerar uma análise de tendências.');
                return;
            }
             if (GEMINI_API_KEY === "COLE_SUA_CHAVE_API_AQUI") {
                 mostrarModal('Por favor, adicione sua chave da API do Google Gemini no código para usar esta funcionalidade.');
                 return;
            }
            mostrarModal(`<div class="spinner" style="margin: 0 auto 15px;"></div>Analisando o histórico... Por favor, aguarde.`);
            el('modal-botoes').style.display = 'none';

            const historicoFormatado = historico.slice(0, 10).reverse().map(item => `- Cota ${item.cota}/${item.mes}/${item.ano}: Valor Líquido R$ ${item.previsaoLiquida}`).join('\n');
            const prompt = `Aja como um analista de dados financeiros especializado em finanças municipais. Analise os seguintes dados históricos de repasses líquidos do FPM para a prefeitura de Camocim de São Félix:\n${historicoFormatado}\n\nCom base exclusivamente nesses dados, identifique a principal tendência (crescimento, queda ou estabilidade) dos valores líquidos. Forneça um resumo executivo de uma frase. Depois, apresente 2 ou 3 observações principais em formato de lista, usando "• " para cada ponto. Mantenha a análise curta, objetiva e focada nos dados fornecidos.`;
            
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${GEMINI_API_KEY}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };

            fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) })
            .then(response => response.json())
            .then(result => {
                const candidate = result.candidates?.[0];
                const modalMsg = el('modal-mensagem');
                const modalBtns = el('modal-botoes');
                modalBtns.style.display = 'block';
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const analysis = candidate.content.parts[0].text.replace(/\n/g, '<br>').replace(/• /g, '<br>• ');
                    modalMsg.innerHTML = `<strong>Análise de Tendências do Histórico ✨</strong><br><br>${analysis}`;
                } else {
                    modalMsg.textContent = 'Não foi possível gerar a análise do histórico. Tente novamente.';
                }
                modalBtns.innerHTML = '<button id="modal-btn-ok" class="download-btn">FECHAR</button>';
                el('modal-btn-ok').onclick = fecharModal;
            })
            .catch(error => {
                el('modal-mensagem').textContent = 'Ocorreu um erro ao conectar com o serviço de IA. Verifique sua conexão e tente novamente.';
            });
        }

        // --- CÓDIGO DO HISTÓRICO E PREENCHIMENTO AUTOMÁTICO ---
        const valoresBrutosPrimeiraCota = JSON.parse(localStorage.getItem('fpmValoresBrutos')) || {};

        function salvarNoHistorico() {
            const cotaNum = val('cotaNumero');
            const cotaM = val('cotaMes');
            const cotaA = val('cotaAno');
            if (!cotaNum || !cotaM || !cotaA || cotaNum === '00' || cotaM === '00' || cotaA === '00') {
                mostrarModal('Por favor, preencha Cota, Mês e Ano antes de salvar.');
                return;
            }
            const calculo = { id: Date.now(), cota: cotaNum, mes: cotaM, ano: cotaA, valorBrutoAnterior: val('valorBrutoAnterior'), multiplicador: val('multiplicador'), valorBrutoResultado: el('resultadoMultiplicacao').textContent, totalDeducoes: el('totalDeducoes').textContent, previsaoLiquida: el('previsaoLiquida').textContent };
            if (parseInt(cotaNum, 10) === 1) {
                valoresBrutosPrimeiraCota[cotaM] = val('valorBrutoAnterior');
                localStorage.setItem('fpmValoresBrutos', JSON.stringify(valoresBrutosPrimeiraCota));
            }
            const historico = JSON.parse(localStorage.getItem('fpmHistorico')) || [];
            historico.unshift(calculo);
            localStorage.setItem('fpmHistorico', JSON.stringify(historico));
            carregarHistorico();
            mostrarModal('Cálculo salvo no histórico com sucesso!');
        }

        function carregarHistorico() {
            const historico = JSON.parse(localStorage.getItem('fpmHistorico')) || [];
            const container = el('historico-conteudo');
            const analiseContainer = el('analise-historico-container');
            const chartsContainer = el('graficos-historico-container');

            if (graficoBrutoHistorico) graficoBrutoHistorico.destroy();
            if (graficoDeducoesHistorico) graficoDeducoesHistorico.destroy();
            if (graficoLiquidoHistorico) graficoLiquidoHistorico.destroy();

            if (historico.length === 0) {
                container.innerHTML = '<p>Nenhum cálculo salvo ainda.</p>';
                analiseContainer.innerHTML = '';
                chartsContainer.style.display = 'none';
                return;
            }
            
            chartsContainer.style.display = 'grid';

            if (historico.length >= 2) {
                 analiseContainer.innerHTML = `<button onclick="analisarHistoricoComIA()" class="download-btn" style="width: 100%;">✨ ANALISAR TENDÊNCIAS COM IA</button>`;
            } else {
                 analiseContainer.innerHTML = '';
            }
            
            let html = `<table style="width: 100%; border-collapse: collapse;"><thead><tr style="background-color: #4A2A20; color: #D9C6A5;"><th style="padding: 8px; border: 1px solid #000;">Cota/Mês/Ano</th><th style="padding: 8px; border: 1px solid #000;">Valor Bruto (Resultado)</th><th style="padding: 8px; border: 1px solid #000;">Total Deduções</th><th style="padding: 8px; border: 1px solid #000;">Previsão Líquida</th></tr></thead><tbody>`;
            historico.forEach(item => {
                html += `<tr style="background-color: #fff; border-bottom: 1px solid #ccc;"><td style="padding: 8px; border: 1px solid #000; text-align: center;">${item.cota}/${item.mes}/${item.ano}</td><td style="padding: 8px; border: 1px solid #000; text-align: right;">R$ ${item.valorBrutoResultado}</td><td style="padding: 8px; border: 1px solid #000; text-align: right;">R$ ${item.totalDeducoes}</td><td style="padding: 8px; border: 1px solid #000; text-align: right;">R$ ${item.previsaoLiquida}</td></tr>`;
            });
            container.innerHTML = html + '</tbody></table>';

            // Chart Data Preparation
            const historicoReverso = [...historico].reverse(); 
            const labels = historicoReverso.map(item => `${item.cota}/${item.mes}/${item.ano}`);
            const dataBruto = historicoReverso.map(item => parseBR(item.valorBrutoResultado));
            const dataDeducoes = historicoReverso.map(item => parseBR(item.totalDeducoes));
            const dataLiquido = historicoReverso.map(item => parseBR(item.previsaoLiquida));

            // Chart 1: Valor Bruto
            graficoBrutoHistorico = new Chart(el('grafico-bruto-historico').getContext('2d'), {
                type: 'line',
                data: { labels, datasets: [{ label: 'Valor Bruto (R$)', data: dataBruto, borderColor: '#4A2A20', backgroundColor: 'rgba(74, 42, 32, 0.1)', fill: true, tension: 0.1 }] },
                options: { responsive: true, plugins: { title: { display: true, text: 'Evolução do Valor Bruto' }, legend: { display: false } } }
            });

            // Chart 2: Total Deduções
            graficoDeducoesHistorico = new Chart(el('grafico-deducoes-historico').getContext('2d'), {
                type: 'line',
                data: { labels, datasets: [{ label: 'Total Deduções (R$)', data: dataDeducoes, borderColor: '#8C2D2D', backgroundColor: 'rgba(140, 45, 45, 0.1)', fill: true, tension: 0.1 }] },
                options: { responsive: true, plugins: { title: { display: true, text: 'Evolução das Deduções' }, legend: { display: false } } }
            });

            // Chart 3: Previsão Líquida
            graficoLiquidoHistorico = new Chart(el('grafico-liquido-historico').getContext('2d'), {
                type: 'line',
                data: { labels, datasets: [{ label: 'Previsão Líquida (R$)', data: dataLiquido, borderColor: '#00A8A8', backgroundColor: 'rgba(0, 168, 168, 0.1)', fill: true, tension: 0.1 }] },
                options: { responsive: true, plugins: { title: { display: true, text: 'Evolução da Previsão Líquida' }, legend: { display: false } } }
            });
        }

        function limparHistorico() {
            mostrarModal('Tem certeza que deseja limpar todo o histórico?', 'confirm', () => {
                localStorage.removeItem('fpmHistorico');
                localStorage.removeItem('fpmValoresBrutos');
                Object.keys(valoresBrutosPrimeiraCota).forEach(key => delete valoresBrutosPrimeiraCota[key]);
                carregarHistorico();
            });
        }

        function verificarPreenchimentoAutomatico() {
            const cotaNum = parseInt(val('cotaNumero'), 10);
            const cotaM = val('cotaMes');
            if ((cotaNum === 2 || cotaNum === 3) && valoresBrutosPrimeiraCota[cotaM]) {
                const valorSalvo = valoresBrutosPrimeiraCota[cotaM];
                el('valorBrutoAnterior').value = valorSalvo;
                calc();
            }
        }
        
        // --- CÓDIGO DA CALCULADORA ---
        const parseBR = s => parseFloat(String(s).replace(/\./g, '').replace(',', '.')) || 0;
        const fmt = n => new Intl.NumberFormat('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n);

        const ctx = el('grafico').getContext('2d');
        const grafico = new Chart(ctx, { type: 'bar', data: { labels: [''], datasets: [{ label: 'Cota mês anterior - Valor bruto', data: [0], backgroundColor: 'rgba(204, 255, 204, 1)', borderColor: 'rgba(180, 150, 100, 1)', borderWidth: 1 }, { label: 'Cota mês atual - Valor Bruto', data: [0], backgroundColor: 'rgba(255, 255, 204, 1)', borderColor: 'rgba(180, 150, 100, 1)', borderWidth: 1 }] }, options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', scales: { x: { beginAtZero: true, title: { display: true, text: 'Valor (R$)' } } } } });

        function atualizarGrafico(br, bev) {
            grafico.data.datasets[1].data = [br];
            grafico.data.datasets[0].data = [bev];
            grafico.update();
        }

        function calc() {
            const vb = parseBR(val('valorBrutoAnterior'));
            const m = parseFloat(val('multiplicador')) || 0;
            const r = vb * m;
            el('resultadoMultiplicacao').textContent = fmt(r);
            calcDeductions(r);
            atualizarGrafico(r, parseBR(val('valorBrutoEquivalente')));
        }

        function calcDeductions(br) {
            const p = br * 0.01;
            const s = br * 0.15;
            const f = br * 0.20;
            const rfb = parseBR(val('parcelamentoRfb'));
            const tot = p + s + f + rfb;
            el('deducaoPasep').textContent = fmt(p);
            el('deducaoSaude').textContent = fmt(s);
            el('deducaoFundeb').textContent = fmt(f);
            el('totalDeducoes').textContent = fmt(tot);
            el('previsaoLiquida').textContent = fmt(br - tot);
        }

        function updateRatio() {
            const l = parseBR(val('valorLiquidoAnterior'));
            const b = parseBR(val('valorBrutoEquivalente'));
            el('pesoPercentualFormatted').textContent = b ? ((l / b) * 100).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + '%' : '0,00%';
            calc();
        }

        el('cotaNumero').addEventListener('input', verificarPreenchimentoAutomatico);
        el('cotaMes').addEventListener('input', verificarPreenchimentoAutomatico);

        el('multiplicador').addEventListener('input', e => {
            let raw = e.target.value.replace(/\D/g, '');
            if (!raw) raw = '0';
            const num = parseFloat(raw) / 10000;
            e.target.value = num.toFixed(4);
            calc();
        });

        el('multiplicador').addEventListener('blur', e => {
            const num = parseFloat(e.target.value);
            e.target.value = isNaN(num) ? '0.0000' : num.toFixed(4);
            calc();
        });

        ['valorBrutoAnterior', 'valorLiquidoAnterior', 'valorBrutoEquivalente', 'parcelamentoRfb'].forEach(id => {
            el(id).addEventListener('input', e => {
                let v = e.target.value.replace(/\D/g, '');
                v = (parseInt(v || 0) / 100).toFixed(2);
                e.target.value = parseFloat(v).toLocaleString('pt-BR', { minimumFractionDigits: 2 });
                if (id === 'valorBrutoAnterior') calc();
                else if (id === 'valorLiquidoAnterior' || id === 'valorBrutoEquivalente') updateRatio();
                else if (id === 'parcelamentoRfb') {
                    if (el('resultadoMultiplicacao').textContent !== '-') {
                       calcDeductions(parseBR(el('resultadoMultiplicacao').textContent));
                    }
                }
            });
        });

        function atualizarDataHora() {
            const now = new Date().toLocaleString('pt-BR', { dateStyle: 'short', timeStyle: 'short' });
            el('dataHoraTela').textContent = '📅 ' + now;
            el('dataHoraPdf').textContent = now;
        }

        function baixarPNG() {
            const elemento = document.querySelector('.container');
            const nomeArquivo = `FPM_${val('cotaNumero')||'X'}_${val('cotaMes')||'00'}.png`;
            html2canvas(elemento, { scale: 3, useCORS: true }).then(canvas => {
                const link = document.createElement('a');
                link.href = canvas.toDataURL('image/png');
                link.download = nomeArquivo;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
        }

        // --- INICIALIZAÇÃO ---
        function inicializar() {
            atualizarDataHora();
            setInterval(atualizarDataHora, 60000);
            el('cotaAno').value = new Date().getFullYear().toString().slice(-2);
            carregarHistorico();
            updateRatio();
        }

        inicializar();

    </script>
</body>
</html>


